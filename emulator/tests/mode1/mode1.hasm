.DEFINE VDP_BASE 0x3000100
.DEFINE VDP_X    0x3000108
.DEFINE VDP_Y    0x300010C

:start
; ==== Set up hblank and vblank interrupt vector ====
	SET [0x3000000], hblank 
	SET [0x3000004], vblank 

; ==== Initialize VDP                            ====
	SET A, VDP_BASE
	
	; Layer mode 1, bitmap
	SET [A], 1
	ADD A, 4

	; Width
	SET [A], 128
	ADD A, 4
	
	; Height
	SET [A], 128
	ADD A, 4
	
	; X
	SET [A], 0
	ADD A, 4
	
	; Y
	SET [A], 56
	ADD A, 4

	; Tileset (not used)
	SET [A], 0
	ADD A, 4
	
	; Palette
	SET [A], pal
	ADD A, 4

	; Bitmap data
	SET [A], bitmap
	ADD A, 4


; ==== Initialize sintab index registers       ====

	SET X, 0
	SET Z, 0

; ==== Loop and halt the CPU                   ====
;         (interrupts will keep waking it up)

:loop
	SYS 0
	SET PC, loop

:vblank
	ADD Z, 8       ; increase index into the sintab
		       ; that X gets reset to (to create the wave effect)

	SET X, Z       ; reset the index into the sintab to Z
	SET PC, POP

:hblank
	MOD X, 1024    ; make sure the index stays within the sintab

	; Set the VDP X and Y position registers to the sintab value
	; Plus the width/height of the bitmap - width/height of the screen / 2

	SET [0x300010C], [sintab+x]
	ADD [0x300010C], 96
	
	SET [0x3000110], [sintab+x]
	ADD [0x3000110], 56
	
	ADD X, 4

	SET PC, POP

:bitmap .INCBIN "bear.dat"
:pal    .INCBIN "bear.pal"
:sintab .INCBIN "sintab.dat"
:msg    .DW "Hblank", 10, 0
